<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Products | Artisan Luthier Tools</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: #1a1a1a;
      line-height: 1.6;
      background: #f9fafb;
    }

    /* Professional Header */
    header {
      background: #ffffff;
      border-bottom: 1px solid #e5e7eb;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    nav {
      max-width: 1280px;
      margin: 0 auto;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      height: 50px;
      width: auto;
    }

    .brand-text {
      font-family: 'Playfair Display', serif;
      font-size: 1.25rem;
      font-weight: 600;
      color: #1f2937;
    }

    nav ul {
      display: flex;
      list-style: none;
      gap: 2rem;
      align-items: center;
    }

    nav a {
      color: #4b5563;
      text-decoration: none;
      font-weight: 500;
      font-size: 0.95rem;
      transition: color 0.2s;
    }

    nav a:hover {
      color: #1f2937;
    }

    /* Page Header */
    .page-header {
      background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
      color: #ffffff;
      padding: 60px 2rem;
      text-align: center;
    }

    .page-header h1 {
      font-family: 'Playfair Display', serif;
      font-size: 2.75rem;
      font-weight: 700;
      margin-bottom: 1rem;
    }

    .page-header p {
      font-size: 1.125rem;
      color: #d1d5db;
      max-width: 700px;
      margin: 0 auto;
    }

    /* Products Section */
    .products-section {
      max-width: 1280px;
      margin: 0 auto;
      padding: 60px 2rem;
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 2rem;
      margin-bottom: 60px;
    }

    .product-card {
      background: #ffffff;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
    }

    .product-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.1);
      border-color: #d1d5db;
    }

    .product-image {
      width: 100%;
      height: 280px;
      background: #f9fafb;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .product-image img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .product-info {
      padding: 1.5rem;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .product-category {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #6b7280;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .product-card h3 {
      font-family: 'Playfair Display', serif;
      font-size: 1.25rem;
      color: #111827;
      margin-bottom: 0.75rem;
      font-weight: 600;
      line-height: 1.3;
    }

    .product-card p {
      color: #4b5563;
      font-size: 0.9375rem;
      margin-bottom: 1.25rem;
      line-height: 1.6;
      flex: 1;
    }

    .product-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 1rem;
      border-top: 1px solid #f3f4f6;
    }

    .price {
      font-size: 1.5rem;
      font-weight: 700;
      color: #111827;
    }

    .price-currency {
      font-size: 0.875rem;
      color: #6b7280;
      font-weight: 500;
    }

    .add-to-cart-btn {
      background: #1f2937;
      color: #ffffff;
      border: none;
      border-radius: 8px;
      padding: 10px 24px;
      font-size: 0.9375rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .add-to-cart-btn:hover:not(:disabled) {
      background: #111827;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(31, 41, 55, 0.2);
    }

    .add-to-cart-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Cart Section */
    .cart-section {
      max-width: 800px;
      margin: 0 auto 60px;
      background: #ffffff;
      border-radius: 12px;
      padding: 2rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .cart-section h2 {
      font-family: 'Playfair Display', serif;
      font-size: 1.875rem;
      margin-bottom: 1.5rem;
      color: #111827;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .cart-list {
      list-style: none;
      margin-bottom: 1.5rem;
    }

    .cart-list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 0;
      border-bottom: 1px solid #f3f4f6;
      font-size: 1rem;
    }

    .cart-list li:last-child {
      border-bottom: none;
    }

    .cart-item-name {
      color: #1f2937;
      font-weight: 500;
    }

    .cart-item-qty {
      color: #6b7280;
      font-size: 0.875rem;
      margin-left: 0.5rem;
    }

    .cart-item-price {
      font-weight: 600;
      color: #111827;
    }

    .cart-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 0;
      border-top: 2px solid #e5e7eb;
      font-size: 1.25rem;
      font-weight: 700;
      color: #111827;
    }

    .checkout-btn {
      background: #1f2937;
      color: #ffffff;
      border: none;
      border-radius: 8px;
      padding: 14px 32px;
      font-size: 1.0625rem;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
    }

    .checkout-btn:hover {
      background: #111827;
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(31, 41, 55, 0.2);
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 100px;
      right: 20px;
      background: #059669;
      color: white;
      padding: 16px 24px;
      border-radius: 8px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      z-index: 1001;
      display: none;
      animation: slideIn 0.3s ease-out;
      font-weight: 500;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .notification.error {
      background: #dc2626;
    }

    /* Trust Badges */
    .trust-section {
      background: #f3f4f6;
      padding: 2rem;
      text-align: center;
      margin-bottom: 60px;
      border-radius: 12px;
    }

    .trust-badges {
      display: flex;
      justify-content: center;
      gap: 2rem;
      flex-wrap: wrap;
      margin-top: 1rem;
    }

    .trust-badge {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: #4b5563;
      font-weight: 500;
    }

    /* Footer */
    footer {
      background: #111827;
      color: #9ca3af;
      padding: 3rem 2rem 1.5rem;
      margin-top: 60px;
    }

    .footer-content {
      max-width: 1280px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .footer-section h4 {
      color: #ffffff;
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .footer-section ul {
      list-style: none;
    }

    .footer-section a {
      color: #9ca3af;
      text-decoration: none;
      display: block;
      margin-bottom: 0.5rem;
      transition: color 0.2s;
    }

    .footer-section a:hover {
      color: #ffffff;
    }

    .footer-bottom {
      max-width: 1280px;
      margin: 0 auto;
      padding-top: 2rem;
      border-top: 1px solid #374151;
      text-align: center;
      font-size: 0.875rem;
    }

    @media (max-width: 768px) {
      .page-header h1 {
        font-size: 2rem;
      }

      .products-grid {
        grid-template-columns: 1fr;
      }

      nav ul {
        gap: 1rem;
      }

      .brand-text {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <nav>
      <div class="logo-container">
        <img src="LOGO.SVG" alt="Artisan Luthier Tools" class="logo">
        <span class="brand-text">Artisan Luthier Tools</span>
      </div>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="products.html">Products</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>
  </header>

  <!-- Page Header -->
  <div class="page-header">
    <h1>Premium Luthier Tools</h1>
    <p>Handcrafted precision instruments for professional violin makers and string instrument craftsmen</p>
  </div>

  <!-- Products Section -->
  <div class="products-section">
    <!-- Trust Section -->
    <div class="trust-section">
      <h3 style="margin-bottom: 0.5rem; color: #111827;">Every Purchase Includes</h3>
      <div class="trust-badges">
        <div class="trust-badge">‚úì Expert Craftsmanship</div>
        <div class="trust-badge">‚úì Quality Guarantee</div>
        <div class="trust-badge">‚úì Secure Payment</div>
        <div class="trust-badge">‚úì Fast Shipping</div>
      </div>
    </div>

    <div class="products-grid" id="products-list">
      <!-- Product cards will be rendered here -->
    </div>

    <!-- Cart Section -->
    <div class="cart-section" id="cart-section" style="display:none;">
      <h2>üõí Your Cart</h2>
      <ul class="cart-list" id="cart-list"></ul>
      <div class="cart-total">
        <span>Total</span>
        <span id="cart-total">$0.00</span>
      </div>
      <button class="checkout-btn" onclick="checkout()">
        Proceed to Secure Checkout
        <span>‚Üí</span>
      </button>
    </div>
  </div>

  <div id="notification" class="notification"></div>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h4>About Us</h4>
        <p>Artisan Luthier Tools was founded in 2024 in Chicago with a mission to provide premium-quality tools for string instrument professionals.</p>
      </div>
      <div class="footer-section">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="products.html">Products</a></li>
          <li><a href="about.html">About Us</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Contact</h4>
        <ul>
          <li>üìû +1 (224) 565-2725</li>
          <li>üìß info@artisanluthiertools.com</li>
          <li>üìç Chicago, IL, USA</li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2024 Artisan Luthier Tools. All rights reserved.</p>
    </div>
  </footer>

  <script>

let csrfToken = null;

async function loadConfig() {
  const res = await fetch('/config', { credentials: 'include' });
  const data = await res.json();
  csrfToken = data.csrfToken;
}

window.onload = async function() {
  await loadConfig();   // üî• get CSRF token first
  renderProducts();
  renderCart();
};

    const products = [
      { 
        id: "cello-neck-adjusting",
        name: "Cello Neck Setting Adjusting Tool", 
        category: "Cello Tools",
        description: "Ensures optimal neck angle alignment for cellos with precision engineering.", 
        price: 420,
        image: "IMG_2757.PNG"
      },
      { 
        id: "cello-neck-fixing",
        name: "Cello Neck Fixing Tool", 
        category: "Cello Tools",
        description: "Securely holds the cello fingerboard and neck in place during neck setting, resetting, or gluing, ensuring stability and precision throughout the process.", 
        price: 350,
        image: "IMG_3000PNG"
      },
      { 
        id: "violin-neck-adjusting",
        name: "Violin/Viola Neck Setting Adjusting Tool", 
        category: "Violin Tools",
        description: "Ensures optimal neck angle alignment for violin/viola with expert precision.", 
        price: 370,
        image: "IMG_2900.png"
      },
      { 
        id: "violin-neck-fixing",
        name: "Violin/Viola Neck Fixing Tool", 
        category: "Violin Tools",
        description: "Securely holds the violin/viola fingerboard and neck in place during neck setting, resetting, or gluing, ensuring stability and precision throughout the process.", 
        price: 285,
        image: "IMG_2800.png"
      },
      { 
        id: "violin-fhole-jack",
        name: "Special Design Violin f-hole Leveling Jack", 
        category: "Repair Tools",
        description: "Designed to precisely align surface cracks on the violin f-holes, ensuring accurate positioning for gluing and optimal structural integrity.", 
        price: 80,
        image: "ART_4.png"
      },
      { 
        id: "cello-fhole-jack",
        name: "Special Design Cello f-hole Leveling Jack", 
        category: "Repair Tools",
        description: "Designed to precisely align surface cracks on the cello f-holes, ensuring accurate positioning for gluing and optimal structural integrity.", 
        price: 100,
        image: "ART_5.png"
      },
      { 
        id: "cello-fhole-clamp",
        name: "Special Design Cello f-hole Crack Clamp", 
        category: "Clamps",
        description: "Aligns and stabilizes cello top cracks at the f-hole for precise gluing and restoration.", 
        price: 380,
        image: "ART_ 6.png"
      },
      { 
        id: "violin-fhole-clamp",
        name: "Special Design Violin/Viola f-hole Crack Clamp", 
        category: "Clamps",
        description: "Aligns and stabilizes violin or viola top cracks at the f-hole for precise gluing.", 
        price: 320,
        image: "ART_ 7.png"
      },
      { 
        id: "violin-clamps-35",
        name: "35 pcs Violin/Viola Clamps", 
        category: "Clamp Sets",
        description: "Complete set of color-coded clamps to protect varnish and edges during gluing operations.", 
        price: 495,
        image: "ART_8.png"
      },
      { 
        id: "cello-clamps-45",
        name: "45 pcs Cello Clamps", 
        category: "Clamp Sets",
        description: "Professional-grade color-coded clamps to protect varnish and edges during gluing.", 
        price: 690,
        image: "ART_9.png"
      }
    ];

    function renderProducts() {
      const list = document.getElementById('products-list');
      list.innerHTML = '';
      
      products.forEach((p, i) => {
        const card = document.createElement('div');
        card.className = 'product-card';
        
        card.innerHTML = `
          <div class="product-image">
            ${p.image ? `<img src="${p.image}" alt="${p.name}">` : ''}
          </div>
          <div class="product-info">
            <div class="product-category">${p.category}</div>
            <h3>${p.name}</h3>
            <p>${p.description}</p>
            <div class="product-footer">
              <div>
                <div class="price">$${p.price}</div>
                <div class="price-currency">USD</div>
              </div>
              <button onclick="addToCart('${p.id}', ${i})" id="btn-${i}" class="add-to-cart-btn">
                <span>Add to Cart</span>
              </button>
            </div>
          </div>
        `;
        list.appendChild(card);
      });
    }

    async function addToCart(productId, btnIndex) {
      const button = document.getElementById(`btn-${btnIndex}`);
      button.disabled = true;
      button.innerHTML = '<span>Adding...</span>';

      try {
        const res = await fetch('/api/cart/add', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include',
          body: JSON.stringify({
            productId: productId,
            qty: 1
          })
        });

        const text = await res.text();
        let data;
        try {
          data = JSON.parse(text);
        } catch (e) {
          throw new Error('Server error. Please try again.');
        }

        if (!res.ok) {
          throw new Error(data.error || 'Failed to add to cart');
        }

        showNotification('‚úì Added to cart!');
        await renderCart();
      } catch (err) {
        console.error('Add to cart error:', err);
        showNotification(err.message || 'Failed to add to cart', true);
      } finally {
        button.disabled = false;
        button.innerHTML = '<span>Add to Cart</span>';
      }
    }

    async function renderCart() {
      try {
        const res = await fetch('/api/cart', {
          credentials: 'include'
        });
        const data = await res.json();
        const cart = data.cart || [];

        const section = document.getElementById('cart-section');
        const list = document.getElementById('cart-list');
        const totalDiv = document.getElementById('cart-total');

        if (cart.length === 0) {
          section.style.display = 'none';
          return;
        }

        section.style.display = 'block';
        list.innerHTML = '';
        let total = 0;

        cart.forEach((item) => {
          total += item.price * item.qty;
          const li = document.createElement('li');
          li.innerHTML = `
            <span class="cart-item-name">
              ${item.name}
              <span class="cart-item-qty">√ó ${item.qty}</span>
            </span>
            <span class="cart-item-price">$${(item.price * item.qty).toFixed(2)}</span>
          `;
          list.appendChild(li);
        });

        totalDiv.textContent = `$${total.toFixed(2)}`;
      } catch (err) {
        console.error('Failed to load cart:', err);
      }
    }

    function showNotification(message, isError = false) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = 'notification' + (isError ? ' error' : '');
      notification.style.display = 'block';
      
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    function checkout() {
      window.location.href = "checkout.html";
    }

    window.onload = function() {
      renderProducts();
      renderCart();
    };
  </script>
</body>
</html>